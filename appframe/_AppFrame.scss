@use "../design/ColorVars" as cl;
@use "../design/ColorUtils" as cu;

//
@use "../core/Utils" as u;
@use "../core/ClassLets";
@use "../design/ColorTheme";

//
@mixin whenMobile {
    --padding: 0rem !important;

    //
    & .titlebar {
        & > :where(.back-button, .menu-button) {
            border-radius: 0.125rem;
        }
    }
}

//
@layer ux-app-frame {
    
    //
    .ux-app-frame {
        //
        @extend .contain-size;
        @extend .align-center;
        @extend .stretch !optional;

        //
        --rx: 0px;
        --ry: 0px;

        //
        --rx: calc(var(--drag-x, 0) * 1px);
        --ry: calc(var(--drag-y, 0) * 1px);

        //
        //--translate-x: clamp(0px, calc(calc(50cqi - 50%) + var(--rx, 0px)), calc(100cqi - 100%));
        //--translate-y: clamp(0px, calc(calc(50cqb - 50%) + var(--ry, 0px)), calc(100cqb - 100%));
        
        //
        --translate-x: clamp(0px, var(--rx, 0px), calc(100cqi - 100%));
        --translate-y: clamp(0px, var(--ry, 0px), calc(100cqb - 100%));
        
        //
        --padding: 0rem;
        
        //
        --padding-top: 0rem;
        
        //
        @media (width < 9in) or (orientation: portrait) {
            --padding-top: max(env(safe-area-inset-top, 0px), 2rem);
        }

        //
        --padding-left: calc(var(--padding) + env(safe-area-inset-left, 0px));
        --padding-right: calc(var(--padding) + env(safe-area-inset-right, 0px));

        //
        padding-block-start: var(--padding-top) !important;

        //
        translate: var(--translate-x) var(--translate-y) 0px;
        will-change: translate, transform, inline-size, block-size, contents, --rx, --ry, --drag-x, --drag-y, --resize-x, --resize-y, --translate-x, --translate-y;
        
        //
        inset: 0px;
        position: fixed;
        z-index: 99999;
    
        //
        contain: content;
        container-type: size;
        container-name: ux-windowed;
        display: grid;
        overflow: hidden;
        
        //
        font-size: 0.9rem;

        //
        grid-template-columns: 
            [menu-button] minmax(3rem, max-content)
            [title-label] minmax(0px, 1fr)
            [back-button] minmax(3rem, max-content);
    
        //
        grid-template-rows: 
            [titlebar] minmax(3rem, max-content) 
            [content-b] minmax(0px, 1fr);

        //
        @media only screen and (hover: none) and (pointer: coarse) and (width < 9in) {
            //
            grid-template-rows: 
                [content-b] minmax(0px, 1fr)
                [titlebar] minmax(3rem, max-content);
        }

        //
        @media all and (width >= 9in) {
            border-radius: 0.25rem;
            box-shadow: 0px 0px 1rem 1px #00000070;
            
            //
            @include u.clamped-width(min(64rem, 100cqi), calc(80rem + var(--resize-x, 0) * 1px), 100cqi);
            @include u.clamped-height(min(36rem, 100cqb), calc(45rem + var(--resize-y, 0) * 1px), 100cqb);
        }

        //
        .ux-resize {
            position: absolute;
            inset: auto;
            inset-inline-end: 0px;
            inset-block-end: 0px;
            inline-size: 1rem;
            block-size: 1rem;
            
            //
            background-color: transparent;
            cursor: nwse-resize;
        }
        
        //
        .ux-title-handle, .ux-title-label {
            @extend .stretch;
            @extend .align-center;
            @extend .align-inline-left;
            @extend .no-wrap;
            @extend .ux-solid;

            //
            display: flex;
            grid-column: title-label;
            grid-row: titlebar;

            //
            flex-direction: row;
            padding: 0.5rem;
            padding-inline: 1rem;
            min-inline-size: max-content;
            cursor: grab;
            
            //
            font-weight: 600;
            font-size: 1rem;
            
            //
            padding-inline: 1rem;
        }
        
        //
        .ux-title-handle {
            @extend .ux-solid;
        }
        
        //
        .ux-title-label {
            @extend .pe-none;
            @extend .ux-solid-transparent;
        }

        //
        @container ux-windowed (width < 9in) {
            @include whenMobile;
        }
        
        //
        @media (width < 9in) {
            @include whenMobile;
        }

        //
        .titlebar {
            @extend .align-center;
            @extend .stretch;
            @extend .pe-enable;
            @extend .no-wrap;
            
            //
            grid-row: titlebar;
            grid-column: 1 / 3 span;
            grid-template-columns: subgrid;
            
            //
            gap: 0px;
            
            //
            box-sizing: border-box;
            block-size: calc(3rem + var(--padding));
            
            //
            border-block-end: solid 1px var(--current-surface-color);
            
            //
            align-items: end;

            //grid-column: 1 / 2;
            grid-row: titlebar;
            min-block-size: max-content;
            
            //
            display: grid;
            
            //
            padding-block: var(--padding, 0px);
            padding-inline: max(var(--padding-left), var(--padding)) max(var(--padding-right), var(--padding));

            
            //
            & > * {
                @extend .align-center;
                @extend .stretch;
                
                //
                display: flex;
                grid-row: 1 / 1 span;
                padding: 1rem;
            }
            
            //
            & > :where(.back-button, .menu-button) {
                padding: 0.75rem;
                cursor: pointer;
                
                //
                max-inline-size: 3rem;
                max-block-size: 3rem;
            }
        }
        
        //
        .ux-content {
            @extend .stretch;
            @extend .ux-solid;
            
            //
            grid-row: content-b;
            grid-column: 1 / 3 span;
        }
    }
}
